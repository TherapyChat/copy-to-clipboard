<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="./copy-to-clipboard-script.html">

<script>
  /* global ClipboardJS */
  /** @polymerBehavior Polymer.CopyToClipboardBehavior */
  Polymer.CopyToClipboardBehavior = {

    properties: {
      clipboard: Object,
      clipboardAction: {
        type: String,
        value: 'copy'
      },
      clipboardSupported: {
        type: Boolean,
        value: false
      },
      clipboardTrigger: Object,
      clipboardValueCopied: {
        type: String,
        notify: true,
        readOnly: true
      },
      clipboardValueToCopy: String
    },

    ready: function () {
      this.clipboardSupported = ClipboardJS.isSupported()
    },

    detached: function () {
      this.clipboardDestroy()
    },

    clipboardCopy: function () {
      if (this.clipboard) this.trigger.click()
    },

    clipboardDestroy: function () {
      if (this.clipboard) this.clipboard.destroy()
      this.clipboard = undefined
    },

    clipboardSetup: function (trigger, options) {
      this.trigger = trigger || this
      options = options || {
        text: trigger => this.clipboardValueToCopy,
        action: trigger => this.clipboardAction
      }

      if (this.clipboard) this.clipboardDestroy()

      this.clipboard = new ClipboardJS(trigger, options)
      this.clipboard.on('success', this._onCopyToClipboardSuccess.bind(this))
      this.clipboard.on('error', this._onCopyToClipboardError.bind(this))
    },

    _onCopyToClipboardError: function (ev) {
      this.dispatchEvent(new CustomEvent('copy-to-clipboard-error', {
        detail: ev
      }))
    },

    _onCopyToClipboardSuccess: function (ev) {
      this._setClipboardValueCopied(ev.text)

      this.dispatchEvent(new CustomEvent('copy-to-clipboard-success', {
        detail: ev
      }))
    }
  }
</script>
